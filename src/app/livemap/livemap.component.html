<div class="livemap-component">
  <!-- <img src="../../assets/GoogleMapTA.jpg" /> -->

  <!-- Form for source and destination: Move to another component -->
  <form [formGroup]="directionForm">
    <div class="map-form form-row d-flex justify-content-center">
      <div class="src form-group col-sm-12 col-md-12 col-lg-5">
        <label>Enter source:</label>
        <input
          ngx-google-places-autocomplete
          class="form-control"
          type="text"
          id="src"
          formControlName="source"
          (onAddressChange)="sourceAddressChange($event)"
        />
        <button
          *ngIf="currentUser && currentUser.home.address != ''"
          class="btn btn-primary"
          (click)="addHome('source')"
        >
          Home <fa-icon [icon]="['fa', 'home']"></fa-icon>
        </button>
        <button
          *ngIf="currentUser && currentUser.work.address != ''"
          class="btn btn-primary"
          (click)="addWork('source')"
        >
          Work <fa-icon [icon]="['fa', 'briefcase']"></fa-icon>
        </button>
      </div>

      <div class="col-sm-12 col-md-12 col-lg-1">
        <div class="row justify-content-center">
          <button
            class="btn btn-secondary fxn-button text-center"
            (click)="swap()"
          >
            &nbsp;<fa-icon [icon]="['fa', 'exchange-alt']"> </fa-icon>
            &nbsp;
          </button>
        </div>
        <div class="row justify-content-center">
          <button
            class="btn btn-secondary fxn-button text-center"
            (click)="setLocationNow()"
          >
            &nbsp;<fa-icon [icon]="['fa', 'location-arrow']"> </fa-icon>
            &nbsp;
          </button>
        </div>
      </div>

      <div class="dest form-group col-sm-12 col-md-12 col-lg-5">
        <label>Enter destination:</label>
        <input
          ngx-google-places-autocomplete
          class="form-control"
          type="text"
          id="dest"
          formControlName="destination"
          (onAddressChange)="destinationAddressChange($event)"
        />
        <button
          *ngIf="currentUser && currentUser.home.address != ''"
          class="btn btn-primary"
          (click)="addHome('destination')"
        >
          Home <fa-icon [icon]="['fa', 'home']"></fa-icon>
        </button>
        <button
          *ngIf="currentUser && currentUser.work.address != ''"
          class="btn btn-primary"
          (click)="addWork('destination')"
        >
          Work <fa-icon [icon]="['fa', 'briefcase']"></fa-icon>
        </button>
      </div>
    </div>
  </form>

  <div class="row justify-content-center">
    <div>
      <h3>Travel Modes</h3>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="direction-buttons btn-group">
      <button
        [class.activated]="isActive('DRIVING')"
        class="btn btn-primary"
        (click)="changeTravel('DRIVING')"
      >
        <fa-icon [icon]="['fa', 'car']"></fa-icon>
      </button>
      <button
        [class.activated]="isActive('WALKING')"
        class="btn btn-primary"
        (click)="changeTravel('WALKING')"
      >
        <fa-icon [icon]="['fa', 'walking']"></fa-icon>
      </button>
      <button
        [class.activated]="isActive('TRANSIT')"
        class="btn btn-primary"
        (click)="changeTravel('TRANSIT')"
      >
        <fa-icon [icon]="['fa', 'train']"></fa-icon>
      </button>
    </div>
  </div>

  <div class="direction-data-container row justify-content-center">
    <div class="direction-data" *ngIf="distance && eta">
      <div class="col-12">
        Travel Mode
      </div>
      <div class="col-12">
        <strong>{{ transitOptions }}</strong>
      </div>
      <div class="col-12">
        Distance
      </div>
      <div class="col-12">
        <strong>{{ distance }}</strong>
      </div>
      <div class="col-12">
        ETA
      </div>
      <div class="col-12">
        <strong>{{ eta }}</strong>
      </div>
    </div>
  </div>

  <div *ngIf="currentUser">
    <app-fave-route-options
      [source]="source"
      [destination]="destination"
      [sourceData]="sourceData"
      [destData]="destData"
      [sourceString]="sourceString"
      [destString]="destString"
      (routeUsed)="onRouteUsed($event)"
    ></app-fave-route-options>
  </div>

  <div class="row justify-content-center">
    <button
      type="button"
      class="btn btn-info filter-button"
      data-toggle="modal"
      data-target="#filterModal"
    >
      Filter
    </button>
  </div>

  <!-- Main map component -->
  <agm-map
    [latitude]="lat"
    [longitude]="lng"
    [zoom]="zoom"
    (mapClick)="onMapClick($event)"
    (boundsChange)="mapPositionChange($event)"
    (zoomChange)="mapZoomChange($event)"
  >
    <!-- Source and destination markers -->
    <agm-marker
      *ngIf="source.lat"
      [latitude]="source.lat"
      [longitude]="source.lng"
      [label]="source.label"
      [markerDraggable]="false"
    >
    </agm-marker>
    <agm-marker
      *ngIf="destination.lat"
      [latitude]="destination.lat"
      [longitude]="destination.lng"
      [label]="destination.label"
      [markerDraggable]="false"
    >
    </agm-marker>

    <!-- Report markers -->
    <div
      *ngFor="let marker of reportMarkers; let i = index"
      class="report-markers-component"
    >
      <app-report-markers [marker]="marker" [index]="i"></app-report-markers>
    </div>

    <!-- Ad markers -->
    <div
      *ngFor="let marker of adMarkers; let i = index"
      class="ad-markers-component"
    >
      <app-ad-markers [marker]="marker" [index]="i"></app-ad-markers>
    </div>

    <agm-direction
      *ngIf="sourceData.lat && destData.lat"
      [origin]="sourceData"
      [destination]="destData"
      [travelMode]="transitOptions"
      (onChange)="deleteMarkers($event)"
    ></agm-direction>

    <!-- Current marker clicked -->
    <agm-marker
      *ngIf="currentMarker"
      [latitude]="currentMarker.lat"
      [longitude]="currentMarker.lng"
      [label]="currentMarker.label"
      [markerDraggable]="false"
    >
      <agm-info-window #cwindow>
        <!-- <div>
          <strong>Latitude:</strong>
          <span>{{ currentMarker.lat }}</span>
        </div>
        <div>
          <strong>Longitude:</strong>
          <span>{{ currentMarker.lng }}</span>
        </div> -->
        <div>
          <strong>{{ location }}</strong>
        </div>
        <div *ngIf="currentUser">
          <!-- Ad button -->
          <button
            *ngIf="currentUser.role >= 1"
            type="button"
            class="btn btn-primary"
            data-toggle="modal"
            data-target="#adModal"
          >
            Advertise
          </button>
          <!-- Report button -->
          <button
            type="button"
            class="btn btn-danger"
            data-toggle="modal"
            data-target="#reportModal"
          >
            Report
          </button>
        </div>
      </agm-info-window>
    </agm-marker>
  </agm-map>

  <app-report-modal></app-report-modal>

  <app-ad-modal></app-ad-modal>

  <app-filter-modal (setFilters)="onFilterSubmit($event)"></app-filter-modal>
</div>
