<div class="livemap-component">
  <!-- <img src="../../assets/GoogleMapTA.jpg" /> -->

  <!-- Form for source and destination: Move to another component -->
  <form>
    <div class="map-form form-row d-flex justify-content-center">
      <div class="src form-group col">
        <label>Enter source:</label>
        <input
          ngx-google-places-autocomplete
          class="form-control"
          type="text"
          id="src"
          (onAddressChange)="sourceAddressChange($event)"
        />
      </div>
      <div class="dest form-group col">
        <label>Enter destination:</label>
        <input
          ngx-google-places-autocomplete
          class="form-control"
          type="text"
          id="dest"
          (onAddressChange)="destinationAddressChange($event)"
        />
      </div>
    </div>
  </form>

  <!-- Main map component -->
  <agm-map
    [latitude]="lat"
    [longitude]="lng"
    [zoom]="zoom"
    (mapClick)="onMapClick($event)"
  >
    <!-- Source and destination markers -->
    <agm-marker
      *ngIf="source"
      [latitude]="source.lat"
      [longitude]="source.lng"
      [label]="source.label"
      [markerDraggable]="false"
    >
    </agm-marker>
    <agm-marker
      *ngIf="destination"
      [latitude]="destination.lat"
      [longitude]="destination.lng"
      [label]="destination.label"
      [markerDraggable]="false"
    >
    </agm-marker>

    <app-report-markers [toReset]="reportSubmit"></app-report-markers>

    <app-ad-markers [toReset]="adSubmit"></app-ad-markers>

    <agm-direction
      *ngIf="source && destination"
      [origin]="source"
      [destination]="destination"
    ></agm-direction>

    <!-- Current marker clicked -->
    <agm-marker
      *ngIf="currentMarker"
      [latitude]="currentMarker.lat"
      [longitude]="currentMarker.lng"
      [label]="currentMarker.label"
      [markerDraggable]="false"
    >
      <agm-info-window #cwindow>
        <div>
          <strong>Latitude:</strong>
          <span>{{ currentMarker.lat }}</span>
        </div>
        <div>
          <strong>Longitude:</strong>
          <span>{{ currentMarker.lng }}</span>
        </div>
        <div *ngIf="currentUser">
          <!-- Ad button -->
          <button
            *ngIf="currentUser.role == 1"
            type="button"
            class="btn btn-primary"
            data-toggle="modal"
            data-target="#adModal"
            (click)="toggleInfoWindow(cwindow)"
          >
            Advertise
          </button>
          <!-- Report button -->
          <button
            type="button"
            class="btn btn-danger"
            data-toggle="modal"
            data-target="#reportModal"
            (click)="toggleInfoWindow(cwindow)"
          >
            Report
          </button>
        </div>
      </agm-info-window>
    </agm-marker>
  </agm-map>

  <app-report-modal></app-report-modal>

  <app-ad-modal></app-ad-modal>
</div>
